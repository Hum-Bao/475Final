CREATE DATABASE baadb;
\c baadb

SELECT current_database();

CREATE TABLE ShippingType (
  ID STRING NOT NULL,
  name STRING NOT NULL,
  PRIMARY KEY (ID)
);

CREATE TABLE ShippingCourier (
  ID STRING NOT NULL,
  name STRING NOT NULL,
  PRIMARY KEY (ID)
);

CREATE TABLE ShippingMethod (
  ID INTEGER NOT NULL,
  typeID STRING,
  courierID STRING,
  PRIMARY KEY (ID),
  FOREIGN KEY (courierID) REFERENCES ShippingCourier(ID) DEFERRABLE,
  FOREIGN KEY (typeID) REFERENCES ShippingType(ID) DEFERRABLE
);

CREATE TABLE Customer (
  ID INTEGER NOT NULL,
  name STRING NOT NULL,
  email STRING UNIQUE,
  phone STRING,
  PRIMARY KEY (ID)
);

CREATE TABLE TransactionType (
  type CHARACTER NOT NULL,
  name STRING NOT NULL,
  PRIMARY KEY (type)
);

CREATE TABLE Region (
  ID INTEGER NOT NULL,
  name STRING NOT NULL,
  PRIMARY KEY (ID)
);

CREATE TABLE Facility (
  ID INTEGER NOT NULL,
  name STRING UNIQUE NOT NULL,
  regionID INTEGER NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (regionID) REFERENCES Region(ID) DEFERRABLE
);

CREATE TABLE Transaction (
  ID INTEGER NOT NULL,
  transactionType CHARACTER NOT NULL,
  time TIMESTAMP NOT NULL,
  shippingID INTEGER NOT NULL,
  facilityID INTEGER NOT NULL,
  customerID INTEGER NOT NULL,
  transactionNum STRING UNIQUE NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (customerID) REFERENCES Customer(ID) DEFERRABLE,
  FOREIGN KEY (shippingID) REFERENCES ShippingMethod(ID) DEFERRABLE,
  FOREIGN KEY (transactionType) REFERENCES TransactionType(type) DEFERRABLE,
  FOREIGN KEY (facilityID) REFERENCES Facility(ID) DEFERRABLE
);

CREATE TABLE GoodCategory (
  ID STRING NOT NULL,
  name STRING NOT NULL,
  PRIMARY KEY (ID)
);

CREATE TABLE Good (
  ID INTEGER NOT NULL,
  name STRING NOT NULL,
  description STRING,
  categoryID STRING NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (categoryID) REFERENCES GoodCategory(ID) DEFERRABLE
);

CREATE TABLE TransactionDetail (
  ID INTEGER NOT NULL,
  transactionID INTEGER NOT NULL,
  goodID INTEGER NOT NULL,
  quantity INTEGER NOT NULL,
  weight STRING NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (transactionID) REFERENCES Transaction(ID) DEFERRABLE,
  FOREIGN KEY (goodID) REFERENCES Good(ID) DEFERRABLE
);
