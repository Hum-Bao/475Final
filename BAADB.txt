CREATE DATABASE baadb;
\c baadb

SELECT current_database();

CREATE TABLE ShippingType (
  ID TEXT NOT NULL,
  name TEXT NOT NULL,
  PRIMARY KEY (ID)
);

CREATE TABLE ShippingCourier (
  ID TEXT NOT NULL,
  name TEXT NOT NULL,
  PRIMARY KEY (ID)
);

CREATE TABLE ShippingMethod (
  ID INTEGER NOT NULL,
  typeID TEXT,
  courierID TEXT,
  PRIMARY KEY (ID),
  FOREIGN KEY (courierID) REFERENCES ShippingCourier(ID) Deferrable Initially Deferred,
  FOREIGN KEY (typeID) REFERENCES ShippingType(ID) Deferrable Initially Deferred
);

CREATE TABLE Customer (
  ID INTEGER NOT NULL,
  name TEXT NOT NULL,
  email TEXT UNIQUE,
  phone TEXT,
  PRIMARY KEY (ID)
);

CREATE TABLE TransactionType (
  type CHARACTER NOT NULL,
  name TEXT NOT NULL,
  PRIMARY KEY (type)
);

CREATE TABLE Region (
  ID INTEGER NOT NULL,
  name TEXT NOT NULL,
  PRIMARY KEY (ID)
);

CREATE TABLE Facility (
  ID INTEGER NOT NULL,
  name TEXT UNIQUE NOT NULL,
  regionID INTEGER NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (regionID) REFERENCES Region(ID) Deferrable Initially Deferred
);

CREATE TABLE Transaction (
  ID INTEGER NOT NULL,
  transactionType CHARACTER NOT NULL,
  time TIMESTAMP NOT NULL,
  shippingID INTEGER NOT NULL,
  facilityID INTEGER NOT NULL,
  customerID INTEGER NOT NULL,
  transactionNum TEXT UNIQUE NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (customerID) REFERENCES Customer(ID) Deferrable Initially Deferred,
  FOREIGN KEY (shippingID) REFERENCES ShippingMethod(ID) Deferrable Initially Deferred,
  FOREIGN KEY (transactionType) REFERENCES TransactionType(type) Deferrable Initially Deferred,
  FOREIGN KEY (facilityID) REFERENCES Facility(ID) Deferrable Initially Deferred
);

CREATE TABLE GoodCategory (
  ID TEXT NOT NULL,
  name TEXT NOT NULL,
  PRIMARY KEY (ID)
);

CREATE TABLE Good (
  ID INTEGER NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  categoryID TEXT NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (categoryID) REFERENCES GoodCategory(ID) Deferrable Initially Deferred
);

CREATE TABLE TransactionDetail (
  ID INTEGER NOT NULL,
  transactionID INTEGER NOT NULL,
  goodID INTEGER NOT NULL,
  quantity INTEGER NOT NULL,
  weight TEXT NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (transactionID) REFERENCES Transaction(ID) Deferrable Initially Deferred,
  FOREIGN KEY (goodID) REFERENCES Good(ID) Deferrable Initially Deferred
);
